{% extends 'diary/base.html' %}
{% load static %}
{% load custom_tags %}
{% load i18n %}

{% block content %}
  <h1>{% trans "ÎŸÎ¹ ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ Î¼Î¿Ï…" %}</h1>
  <p>{% trans "Î•Î´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î´ÎµÎ¹Ï‚ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ ÏƒÎ¿Ï…." %}</p>

  <form method="get" action="{% url 'my_entries' %}">
    <input type="text" name="q" placeholder="{% trans 'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·...' %}" value="{{ query }}">
    <button type="submit">{% trans "Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·" %}</button>
  </form>

  {% if entries %}
    <ul class="list-unstyled">
      {% for entry in entries %}
        <li class="mb-4">
          <strong>{{ entry.date }}</strong> â€”
          {% trans "Mood" %}: {{ entry.get_mood_display|default:"â€”" }} â€”
          {% trans "Tag" %}: {{ entry.get_tag_display|default:"â€”" }}<br>

          {% if entry.image %}
            <img src="{{ entry.image.url }}" alt="{% trans 'Î•Î¹ÎºÏŒÎ½Î±' %}" style="max-width: 100px; max-height: 100px;">
          {% endif %}

          {% if entry.note %}<p>{{ entry.note }}</p>{% endif %}

          {% if entry.is_private %}<em>({% trans "Î™Î´Î¹Ï‰Ï„Î¹ÎºÏŒ" %})</em>{% endif %}
          {% if entry.is_favorite %}<em>({% trans "Î‘Î³Î±Ï€Î·Î¼Î­Î½Î¿" %})</em>{% endif %}
          {% if entry.is_important %}<em>({% trans "Î£Î·Î¼Î±Î½Ï„Î¹ÎºÏŒ" %})</em>{% endif %}
          {% if entry.is_urgent %}<em>({% trans "Î•Ï€ÎµÎ¯Î³Î¿Î½" %})</em>{% endif %}
          {% if entry.is_reminder %}<em>({% trans "Î¥Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ·" %})</em>{% endif %}
          {% if entry.is_public %}<em>({% trans "Î”Î·Î¼ÏŒÏƒÎ¹Î¿" %})</em>{% endif %}

          <br>
          <a href="{% url 'entry_view' entry.date %}" class="btn btn-sm btn-custom mt-2">
            {% trans "Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±" %} --
          </a>

          <!-- âœ… Î”Î¹Î±Î³ÏÎ±Ï†Î® Î¼Îµ soft delete -->
          <form method="post" action="{% url 'delete_entry' entry.date %}" style="display:inline;">
            {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-custom mt-2"
                onclick="return confirm('{% trans 'Î•Î¯ÏƒÎ±Î¹ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÏƒÏ„Î¿Î½ ÎšÎ¬Î´Î¿;' %}')">
                ğŸ—‘ï¸ {% trans "ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¿Î½ ÎšÎ¬Î´Î¿" %}
              </button>

          </form>

          <!-- âœ… Î—Î¼ÎµÏÎ®ÏƒÎ¹ÎµÏ‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ -->
          {% with entry.date|stringformat:"s" as this_date %}
            {% for d, answers in answers_by_date.items %}
              {% if d|stringformat:"s" == this_date %}
                <button class="btn btn-sm btn-outline-secondary mt-2" type="button"
                        data-bs-toggle="collapse" data-bs-target="#collapse-{{ this_date }}">
                  â• {% trans "Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î‘Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½" %}
                </button>

                <div class="collapse mt-2" id="collapse-{{ this_date }}">
                  <ul>
                    {% for ans in answers %}
                      <li><strong>{% blocktrans with qnum=ans.question_number %}Î•ÏÏÏ„Î·ÏƒÎ· {{ qnum }}:{% endblocktrans %}</strong> {{ ans.answer }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}
            {% endfor %}
          {% endwith %}
          <br>

          {% for badge in user.userbadge_set.all %}
            <span class="badge bg-success">{{ badge.badge_type }}</span>
          {% endfor %}

          <hr>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>{% trans "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚." %}</p>
  {% endif %}

  <!-- âœ… ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎµÎ¾Î±Î³Ï‰Î³Î®Ï‚ -->
  <div class="mt-4 mb-4">
    <a href="{% url 'export_all_answers_pdf' %}" class="btn btn-outline-danger me-2">
      ğŸ§¾ {% trans "Î•Î¾Î±Î³Ï‰Î³Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î—Î¼ÎµÏÎ®ÏƒÎ¹Ï‰Î½ Î‘Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ (PDF)" %}
    </a>
    <a href="{% url 'export_all_entries_pdf' %}" class="btn btn-outline-primary">
      ğŸ““ {% trans "Î•Î¾Î±Î³Ï‰Î³Î® ÎŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÏ‰Î½ (PDF)" %}
    </a>
  </div>
{% endblock %}
